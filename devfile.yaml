schemaVersion: 2.2.0
variables:
  APP_NAME: costoptstreamlitodo
  IMAGE_NAME: healthfirstdocker/costoptstreamlitodo:latest
  CONTAINER_PORT: "8601"
metadata:
  name: costoptstreamlitodo
  version: 1.0.0
  description: A web service template.
  language: Python
  architectures: [ 'amd64' ]
components:
  - name: runtime
    container:
      image: healthfirstdocker/costoptstreamlitodo:latest
      endpoints:
        - name: http-8601
          targetPort: 8601
  # This will build the container image before deployment

commands:
# - id: apt-get
#   exec:
#     commandLine: sudo apt-get update && sudo apt-get install -y build-essential curl ca-certificates software-properties-common git && rm -rf /var/lib/apt/lists/*
#     component: runtime
#     group:
#       kind: build
#       isDefault: true
 - id: pip
   exec:
     commandLine: pip3 install -r requirements.txt
     component: runtime
     workingDir: ${PROJECT_SOURCE}
     group:
       kind: build
       isDefault: true
 - id: ssocache
   exec:
     commandLine: mkdir -p /tmp/.aws/sso/cache
     component: runtime
     group:
       kind: build
 - id: package
   composite:
    commands:
#      - apt-get
      - pip
      - ssocache
    parallel: false
 - id: run
   exec:
    commandLine: streamlit run HF_CostOpt_Home.py --server.port=8601 --server.address=0.0.0.0
    component: runtime
    workingDir: ${PROJECT_SOURCE}
    group:
      isDefault: true
      kind: run
